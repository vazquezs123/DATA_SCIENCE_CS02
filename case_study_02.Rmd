---
title: "CaseStudy02"
author: "Team ..."
date: "April 7, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r }
setwd("C:\\Users\\vazqu\\Documents\\SMU\\data_science\\CaseStudy2_2\\DATA_SCIENCE_CS02")
library(openxlsx)
library(MASS)
library(ggplot2)
library(classInt)
attritionData <- read.xlsx("CaseStudy2-data.xlsx")

# general landscape of attritiion - how many attritions?
# clearly more no; not common to leave
attritionYesCount <- length(attritionData$Attrition[attritionData$Attrition== "Yes"]) # 237
attritionNoCount <- length(attritionData$Attrition[attritionData$Attrition== "No"]) # 1233
attritionData$Attrition <- as.factor(attritionData$Attrition)
attritionData$Gender <- as.factor(attritionData$Gender)

attritionData$Age <- as.integer(attritionData$Age)
attritionData$JobRole <- as.factor(attritionData$JobRole)
attritionData$MaritalStatus <- as.factor(attritionData$MaritalStatus)
attritionData$AgeGroups <- cut(attritionData$Age, breaks=c(10,20,30,40,50,60))
attritionData$MonthlyIncomeGroup <-cut(attritionData$MonthlyIncome, 
                                       breaks=data.frame(
                                         classIntervals(
                                           attritionData$MonthlyIncome, n=5,
                                           method="quantile")[2])[,1],
                                         include.lowest=T,dig.lab=10)

attritionData$YearlyIncome <- attritionData$MonthlyIncome*12
attritionData$YearlyIncomeGroup <- cut(attritionData$YearlyIncome, 
                                       breaks=data.frame(
                                         classIntervals(
                                           attritionData$YearlyIncome, n=5,
                                           method="quantile")[2])[,1],
                                         include.lowest=T,dig.lab=10)

attritionMaleCount <- length(attritionData$Gender[attritionYesData$Gender=="Male"])
attritionFemaleCount <- length(attritionData$Gender[attritionYesData$Gender == "Female"])
attritionYesData <- attritionData[attritionData$Attrition == "Yes",]
attritionYesMaleCount <- length(attritionYesData$Gender[attritionYesData$Gender=="Male"])
attritionYesFemaleCount <- length(attritionYesData$Gender[attritionYesData$Gender == "Female"])

pairs(~Attrition+YearlyIncome+Age+Gender+JobInvolvement+JobSatisfaction+JobLevel+Education+
        YearsSinceLastPromotion+attritionData$MaritalStatus,data=attritionData, 
   main="Simple Scatterplot Matrix")

pairs(~Attrition+YearlyIncome+Age+Gender+JobInvolvement+JobSatisfaction+JobLevel+Education+
        YearsSinceLastPromotion,data=attritionData, 
   main="Simple Scatterplot Matrix")

# generate scatter plot matrix
pairs(~mpg+disp+drat+wt,data=mtcars, 
   main="Simple Scatterplot Matrix")

# stepwise regression
fit <- lm(Attrition~Age+Education, data=attritionYesData)
logitFunc <- glm(Attrition ~ Age + YearsInCurrentRole, data=attritionData)


# does age have an impact on attrition

ggplot(attritionData, aes(x = AgeGroups, y = Attrition)) +
    geom_bar(stat="identity")+
    labs(title = "Attrition Age Group by GenderPlot") + facet_grid(. ~ Gender)
ggsave("Attrition_Age_plot.png", width = 20, height=20)

ggplot(attritionData, aes(x = WorkLifeBalance, y = Attrition, col=JobRole)) +
    geom_bar(stat = "identity", aes(fill = JobRole)) +
    theme(panel.background = element_rect(fill = "#FDF8E2"),
          axis.text.x = element_text(angle = 90, hjust = 1),
          plot.title = element_text(hjust = 0.5)) +
    labs(title = "Attrition Work Life Balance by Work Life Balance Plot") + facet_grid(. ~ Gender)
ggsave("Attrition_WorkLifeBalance_Plot.png", width = 20, height=20)

ggplot(attritionData, aes(x = WorkLifeBalance, y = Attrition, col=JobRole)) +
    geom_bar(stat = "identity", aes(fill = JobRole)) +
    theme(panel.background = element_rect(fill = "#FDF8E2"),
          axis.text.x = element_text(angle = 90, hjust = 1),
          plot.title = element_text(hjust = 0.5)) +
    labs(title = "Attrition Work Life Balance by Work Life Balance Plot") + facet_grid(. ~ Gender)
ggsave("Attrition_WorkLifeBalance_Plot.png", width = 20, height=20)

ggplot(attritionData, aes(x = MonthlyIncomeGroup, y = Attrition, fill=Gender)) +
    geom_bar(stat = "identity", position="dodge") +
    labs(title = "Attrition Monthly Income Plot")
ggsave("Attrition_MonthlyIncome_Plot.png", width = 20, height=20)

ggplot(attritionData, aes(x = MaritalStatus, y = Attrition, fill=factor(JobRole))) +
    geom_bar(stat = "identity", position="dodge") +
    theme(panel.background = element_rect(fill = "#FDF8E2"),
          axis.text.x = element_text(angle = 0, hjust = 1),
          plot.title = element_text(hjust = 0.5)) +
    labs(title = "Attrition Gender Marital Status Plot") 
ggsave("Attrition_Gender_MaritalStatus_Plot.png", width = 20, height=20)

ggplot(attritionData, aes(x = MonthlyIncomeGroup, y = Attrition, col=AgeGroups)) +
    geom_bar(stat = "identity", aes(fill=AgeGroups))  +
    labs(title = "Attrition Monthly Income Age Group by Gender Plot") + facet_grid(. ~ Gender)
ggsave("Attrition_MonthlyIncome_AgeGroup_Plot.png")

ggplot(attritionData, aes(x = DistanceFromHome, y = Attrition, col=AgeGroups)) +
    geom_bar(stat = "identity", aes(fill=AgeGroups))  +
    labs(title = "Attrition Distance from home Age Group by Gender Plot") + facet_grid(. ~ Gender)
ggsave("Attrition_DistanceFromHome_AgeGroup_Plot.png")



People retire, midlife crisis?
WorklifeBalance
People retire, midlife crisis?
JobInvolvment/JobSatisfaction
Are people bored? Are they engaged? Too much work?
Years at company
Do the longer people work at company deter them more from leaving?
Job Role
What jobs have the most people leaving? 
Monthly Income
Is there an average wage that causes people to leave?
Gender
Which gender is leaving more? 


```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
